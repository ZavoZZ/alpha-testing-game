name: Health Check

on:
  schedule:
    # Run every 15 minutes
    - cron: '*/15 * * * *'
  workflow_dispatch:

jobs:
  health-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check main application
        run: |
          echo "üè• Checking main application..."
          curl -f https://ovidiuguru.online/health || exit 1
          echo "‚úÖ Main application is healthy"
      
      - name: Check API endpoints
        run: |
          echo "üè• Checking API endpoints..."
          
          # Check economy API
          curl -f https://ovidiuguru.online/api/economy/health || echo "‚ö†Ô∏è Economy API unhealthy"
          
          # Check auth API
          curl -f https://ovidiuguru.online/api/auth/health || echo "‚ö†Ô∏è Auth API unhealthy"
          
          # Check news API
          curl -f https://ovidiuguru.online/api/news/health || echo "‚ö†Ô∏è News API unhealthy"
          
          # Check chat API
          curl -f https://ovidiuguru.online/api/chat/health || echo "‚ö†Ô∏è Chat API unhealthy"
          
          echo "‚úÖ Health checks complete"
      
      - name: Check response time
        run: |
          echo "‚è±Ô∏è Checking response time..."
          time curl -s https://ovidiuguru.online > /dev/null
          echo "‚úÖ Response time check complete"
      
      - name: Notify if unhealthy
        if: failure()
        run: |
          echo "‚ùå Health check failed! Server may be down."
          # Add notification logic here (email, Slack, etc.)
